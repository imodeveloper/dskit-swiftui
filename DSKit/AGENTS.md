# Agent Instructions

## Purpose
- DSKit is the Swift Package source for the design system library used by DSKitExplorer and MNews.

## Structure
- `Sources/DSKit/Views`: reusable SwiftUI components.
- `Sources/DSKit/Modifiers`: DSKit view modifiers.
- `Sources/DSKit/Appearances`: theme/appearance definitions.
- `Sources/DSKit/Designable`, `Fonts`, `Helpers`: supporting types.

## Integration Points
- Built as `DSKit.framework` by `DSKitExplorer.xcodeproj`.
- Embedded into MNews when using `../imodeveloperlab/Workspace.xcworkspace`.

## Conventions / Pitfalls
- Keep components deterministic for snapshot tests.
- Many docs in `Content/` depend on snapshots generated by tests.
- Preserve `List` virtualization semantics in wrappers. In particular, `DSSection` should not wrap section content in a container that groups all logical rows into one row.
- For large feeds, prefer exposing child rows directly via `Section { content() }`.
- `DSCoverFlow` must remain stable on the `UIScrollView` bridge; avoid pagination state rewrites that have caused preview crashes.
- `DSCoverFlow.height` represents viewport height; if pagination is shown, add indicator + spacing into final container height.
- `DSHScroll` inset math:
  - `dsScrollableContentMarginKey` is the content inset `DSHScroll` uses for first/last item alignment.
  - `dsContentMarginKey` is host container margin context; avoid adding it again in `DSHScroll` compensation.
  - `dsScreenMarginsAlreadyApplied` indicates a parent (for example `DSList`/`DSSection`) already owns screen margins.
  - Current stable rule in `DSHScroll`: keep inner `.padding(.horizontal, scrollableContentMargin)` and outer `.padding(.horizontal, -scrollableContentMargin)`.

## Run / Test in Isolation
- Run snapshot tests via `DSKitExplorer` scheme (includes DSKitTests in the test plan).
